<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Apr 2018 Case Study – Radar + Alerts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="./leaflet.css"/>
  <script src="./leaflet.js"></script>

  <style>
    html, body { height:100%; margin:0; }
    #map { height:100%; background:#fff; }

    /* --- Banner --- */
    .tvbanner{
      position:absolute; top:0; left:0; right:0;
      z-index:99999;
      background:rgba(11,28,45,0.90);
      color:#fff;
      border-bottom:2px solid rgba(255,255,255,0.12);
      font-family: Arial, sans-serif;
    }
    .tvbanner::before{
      content:"";
      position:absolute; top:0; left:0; right:0;
      height:4px;
      background:#2f4e94;
    }
    .banner-topline{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:8px 14px 5px 14px;
      letter-spacing:.7px;
      text-transform:uppercase;
    }
    .topline-center{
      display:flex;
      align-items:baseline;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      text-align:center;
      max-width:1200px;
      width:100%;
    }
    .top-lesson{font-weight:900;font-size:26px;white-space:nowrap}
    .top-sep{opacity:.65;font-weight:900}
    .top-question{
      font-weight:800;font-size:16px;letter-spacing:.2px;
      text-transform:none;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      max-width:100%;
    }
    .top-q-label{font-weight:900;text-transform:uppercase;letter-spacing:.6px}
    .banner-divider{ height:3px; width:100%; background:#eab35b; opacity:0.95; }

    .banner-bottomline{
      display:flex;
      justify-content:center;
      padding:3px 14px 7px 14px;
    }
    .bottomline-center{
      display:flex;
      align-items:center;
      gap:12px;
      width:100%;
      max-width:1200px;
      justify-content:center;
      flex-wrap:wrap;
    }

    .bbtn{
      border:1px solid rgba(255,255,255,0.35);
      background:rgba(0,0,0,0.25);
      color:#fff;
      padding:10px 12px;
      border-radius:12px;
      font-weight:900;
      cursor:pointer;
      line-height:1;
    }
    .bbtn:hover{ background:rgba(0,0,0,0.40); }
    .bbtn:active{ transform: translateY(1px); }

    /* START button pinned top-right */
    #beginStoryBtn{
      position:absolute;
      right:16px;
      top:10px;
      background:#fdd835;
      color:#111;
      border-color: rgba(0,0,0,0.35);
      letter-spacing:.8px;
      padding:12px 16px;
    }

    .opacity-wrap{display:flex;align-items:center;gap:8px}
    .op-label{font:900 12px/1 Arial,sans-serif;letter-spacing:.7px;text-transform:uppercase}
    #radarOpacity{width:180px}

    .banner-product{min-width:200px;display:flex;justify-content:center}
    .product-center{
      font:900 44px/1 Arial,sans-serif;
      letter-spacing:1px;
      text-transform:uppercase;
      white-space:nowrap;
    }
    .time-controls{display:flex;align-items:center;gap:10px}
    .btime{
      font:900 16px/1 Arial,sans-serif;
      letter-spacing:.7px;
      text-transform:uppercase;
      white-space:nowrap;
      min-width:230px;
      text-align:center;
    }

    /* Leaflet layer control nudge below banner */
    .leaflet-top.leaflet-right { margin-top: 92px; }

    /* Story panel */
    #storyPanel{
      position:absolute;
      top:92px;
      left:10px;
      width:390px;
      max-width:86vw;
      max-height: calc(100vh - 92px);
      overflow:auto;
      z-index:100001;
      background:rgba(255,255,255,0.97);
      border:1px solid rgba(0,0,0,0.18);
      border-radius:16px;
      box-shadow: 0 10px 28px rgba(0,0,0,.18);
      padding:12px 12px 10px 12px;
      transform: translateX(-110%);
      transition: transform 180ms ease;
    }
    #storyPanel.story-open{ transform: translateX(0); }
    .story-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .story-title{ font:900 16px/1.15 Arial, sans-serif; letter-spacing:.2px; }
    .story-close{
      border:1px solid rgba(0,0,0,.25);
      background:#fff;
      border-radius:10px;
      padding:4px 8px;
      font-weight:900;
      cursor:pointer;
    }
    .story-body{ margin-top:10px; font:700 13px/1.35 Arial, sans-serif; color:#111; }
    .story-body p{ margin:0 0 10px 0; }
    .story-media{ margin-top:10px; }
    .story-media img{ width:100%; border-radius:12px; border:1px solid rgba(0,0,0,0.12); }
    .story-media iframe{ width:100%; aspect-ratio: 16/9; border:0; border-radius:12px; }
    .story-nav{ display:flex; justify-content:space-between; gap:10px; margin-top:10px; }
    .story-nav .btn{ flex:1; }
    .btn{
      border:1px solid #333; background:#fff; border-radius:12px;
      padding:8px 10px; cursor:pointer; font:900 12px Arial;
    }
    .tiny { font:700 11px/1.2 Arial, sans-serif; opacity:.78; }
    #storyStep{ margin-top:8px; }

    /* Student/Teacher mode */
    body.student-mode .leaflet-control-layers { display:none !important; }

    /* Logo */
    #brandLogo{
      position:absolute;
      right:10px;
      bottom:-12px; /* “sit lower” */
      z-index:900;
      width:210px;
      max-width:24vw;
      height:auto;
      opacity:0.95;
      filter: drop-shadow(0 3px 10px rgba(0,0,0,0.35));
      pointer-events:none;
    }

    /* Mini legend */
    .map-legend{
      position:absolute;
      right:10px;
      bottom:62px;
      z-index:900;
      background:rgba(11,28,45,0.80);
      border:1px solid rgba(255,255,255,0.18);
      border-radius:12px;
      padding:7px 9px;
      color:#fff;
      font-family: Arial, sans-serif;
    }
    .map-legend-row{display:flex;align-items:center;gap:10px}
    .leg-mini-label{font:900 12px/1 Arial,sans-serif;letter-spacing:.7px;text-transform:uppercase;opacity:.95}
    .leg-mini-bar{
      width:120px;height:10px;border-radius:7px;
      background:linear-gradient(90deg,#2b83ba,#ffd166,#ef476f);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.18);
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <div id="mapLegend" class="map-legend" title="Radar reflectivity">
    <div class="map-legend-row">
      <span class="leg-mini-label">Light</span>
      <span class="leg-mini-bar" aria-hidden="true"></span>
      <span class="leg-mini-label">Heavy</span>
    </div>
  </div>

  <div id="storyPanel" aria-label="Story panel">
    <div class="story-head">
      <div class="story-title" id="storyTitle">Story</div>
      <button class="story-close" id="storyCloseBtn" title="Close">✕</button>
    </div>
    <div class="story-body" id="storyBody">
      <p class="tiny">Loading story…</p>
    </div>
    <div class="story-nav">
      <button class="btn" id="storyPrevBtn">Back</button>
      <button class="btn" id="storyNextBtn">Next</button>
    </div>
    <div class="tiny" id="storyStep"></div>
  </div>

  <div id="banner" class="tvbanner">
    <div class="banner-topline" role="banner">
      <div class="topline-center">
        <span class="top-lesson" id="lessonLabel">Lesson 1: Driving Question</span>
        <span class="top-sep">—</span>
        <span class="top-question">
          <span class="top-q-label">Question:</span>
          <span id="questionLabel">How can we use real-time weather data to make safer decisions?</span>
        </span>
      </div>
      <button class="bbtn" id="beginStoryBtn" title="Begin the guided story">START</button>
    </div>

    <div class="banner-divider" aria-hidden="true"></div>

    <div class="banner-bottomline">
      <div class="bottomline-center">
        <button class="bbtn" id="modeBtn" title="Toggle Student / Teacher mode">STUDENT</button>

        <div class="opacity-wrap" title="Radar opacity">
          <span class="op-label">Opacity</span>
          <input id="radarOpacity" type="range" min="20" max="100" value="70" />
        </div>

        <div class="banner-product" aria-label="Product shown">
          <div class="product-center" id="productLabel">RADAR</div>
        </div>

        <div class="time-controls" aria-label="Time controls">
          <button class="bbtn" id="bBackBtn" title="Back 3 hours">◀</button>
          <div class="btime" id="bannerTimeLabel">April 14, 2018 7AM</div>
          <button class="bbtn" id="bFwdBtn" title="Forward 3 hours">▶</button>
        </div>

        <button class="bbtn" id="zoomOutBtn" title="Zoom out">−</button>
        <button class="bbtn" id="zoomInBtn" title="Zoom in">+</button>
      </div>
    </div>
  </div>

  <img id="brandLogo" src="./logo.png" alt="Weather Workshops" />

  <script>
  (function(){
    // ==========================================================
    // CONFIG (edit these per lesson)
    // ==========================================================
    var STEP_HOURS = 3;

    // Time window (UTC)
    var startZ = new Date(Date.UTC(2018, 3, 14, 12, 0, 0)); // Apr 14 12Z
    var endZ   = new Date(Date.UTC(2018, 3, 15, 12, 0, 0)); // Apr 15 12Z
    var curZ = new Date(startZ.getTime());

    // Stop zooming out too far (your earlier idea)
    var MIN_ZOOM = 5;     // <- change this
    var MAX_ZOOM = 11;    // <- change this
    // Optional: lock panning to CONUS-ish so students can't “lose the map”
    var USE_MAX_BOUNDS = true;
    var MAX_BOUNDS = L.latLngBounds(L.latLng(18, -133), L.latLng(56, -60));

    // Radar bounds shift (your tuned offsets)
    var SHIFT_LAT = -1.09;
    var SHIFT_LON =  0.49;
    var RADAR_BOUNDS = L.latLngBounds(
      L.latLng(24 + SHIFT_LAT, -126 + SHIFT_LON),
      L.latLng(50 + SHIFT_LAT,  -66 + SHIFT_LON)
    );

    // Story (Google Sheet via opensheet)
    var SHEET_ID = "17Hzg7R2fSHJGbOKAKMqG4QAqA1GlSJwFM-SQwPhQObY";
    var SHEET_TAB = "April Blizzard Story";

    // ==========================================================
    // Helpers
    // ==========================================================
    function pad2(n){ return (n<10?'0':'') + n; }
    function yyyymmdd(d){
      return d.getUTCFullYear() + pad2(d.getUTCMonth()+1) + pad2(d.getUTCDate());
    }
    function hhmm(d){
      return pad2(d.getUTCHours()) + pad2(d.getUTCMinutes());
    }
    function radarUrlFor(d){
      return "radar_frames/n0q_" + yyyymmdd(d) + hhmm(d) + ".png";
    }
    function alertsUrlFor(d){
      return "timeline_hourly/alerts_" + yyyymmdd(d) + "_" + pad2(d.getUTCHours()) + "00Z.geojson";
    }

    // Simple Central-time label (fixed -5h, no DST complexity)
    function formatCentralLabelFromUTC(dUTC) {
      var ms = dUTC.getTime() - (5 * 3600 * 1000);
      var d = new Date(ms);
      var months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
      var m = months[d.getMonth()];
      var day = d.getDate();
      var year = d.getFullYear();
      var hr = d.getHours();
      var ampm = hr >= 12 ? "PM" : "AM";
      hr = hr % 12; if (hr === 0) hr = 12;
      return m + " " + day + ", " + year + " " + hr + ampm;
    }

    function escapeHtml(s){
      return String(s)
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }

    // ==========================================================
    // Map
    // ==========================================================
    var mapOpts = { zoomControl:true, minZoom: MIN_ZOOM, maxZoom: MAX_ZOOM };
    if (USE_MAX_BOUNDS){
      mapOpts.maxBounds = MAX_BOUNDS;
      mapOpts.maxBoundsViscosity = 0.9;
    }

    var map = L.map("map", mapOpts).setView([43.55, -96.73], 6);

    L.tileLayer(
      "https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png",
      { attribution: "&copy; OpenStreetMap &copy; CARTO", subdomains:"abcd", maxZoom: 19 }
    ).addTo(map);

    L.tileLayer(
      "https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}.png",
      { attribution: "", subdomains:"abcd", maxZoom: 19, pane: "overlayPane" }
    ).addTo(map);

    // Optional state outlines (kept from your file)
    (function(){
      map.createPane("stateOutlinePane");
      map.getPane("stateOutlinePane").style.zIndex = 460;
      var outlineUrl = "https://raw.githubusercontent.com/PublicaMundi/MappingAPI/master/data/us-states.json";
      fetch(outlineUrl).then(r => r.json()).then(gj => {
        L.geoJSON(gj, {
          pane: "stateOutlinePane",
          interactive: false,
          style: { color: "#555", weight: 2.5, opacity: 0.7, fillOpacity: 0 }
        }).addTo(map);
      }).catch(()=>{});
    })();

    // ==========================================================
    // Layers: Radar + Alerts
    // ==========================================================
    var obsRadarOverlay = null;
    var obsRadarEnabled = true;

    var alertsLayer = L.geoJSON(null, {
      filter: function(f){
        var p = (f && f.properties) ? f.properties : {};
        var ev = String(p.event || p.EVENT || p.headline || p.HEADLINE || "").toLowerCase();
        var phe = String(p.phenomena || p.PHENOM || p.phenom || "").toLowerCase();
        var sig = String(p.significance || p.SIG || p.sig || "").toLowerCase();

        if (ev){
          if (ev.includes("statement") || ev.includes("advisory") || ev.includes("watch")) return false;
          return ev.includes("warning");
        }
        if (sig === "w") return true;
        return false;
      },
      style: function(f){
        var p = (f && f.properties) ? f.properties : {};
        var ev = String(p.event || p.EVENT || p.headline || p.HEADLINE || p.phenomena || "").toLowerCase();
        var phe = String(p.phenomena || p.PHENOM || "").toLowerCase();

        var key = ev || phe || "";
        var stroke = "#42a5f5", fill = "#42a5f5";

        if (key.includes("tornado") || phe==="to")      { stroke = fill = "#e53935"; }
        else if (key.includes("severe thunderstorm") || phe==="sv") { stroke = fill = "#fdd835"; }
        else if (key.includes("flash flood") || phe==="ff")         { stroke = fill = "#00c853"; }
        else if (key.includes("flood") || phe==="fl")               { stroke = fill = "#00c853"; }

        return { color: stroke, weight: 2, opacity: 0.95, fillColor: fill, fillOpacity: 0.22 };
      },
      onEachFeature: function(f, layer){
        var props = f.properties || {};
        var title = props.event || props.EVENT || props.headline || props.HEADLINE || props.prod_type || props.phenomena || "Warning";
        layer.bindPopup("<b>" + escapeHtml(String(title)) + "</b>");
      }
    }).addTo(map);

    // Layer control (only radar checkbox)
    var overlays = { "Composite Radar (Observed)": L.layerGroup() };
    L.control.layers(null, overlays, { collapsed:false }).addTo(map);

    // Force checkbox checked on load
    setTimeout(function(){
      var inputs = document.querySelectorAll(".leaflet-control-layers-overlays input");
      inputs.forEach(function(inp){
        var label = (inp.parentElement && inp.parentElement.textContent) || "";
        if (label.indexOf("Composite Radar") !== -1) inp.checked = true;
      });
      var baseBox = document.querySelector(".leaflet-control-layers-base");
      if (baseBox) baseBox.style.display = "none";
    }, 50);

    map.on("overlayadd", function(e){
      if (e.name === "Composite Radar (Observed)") { obsRadarEnabled = true; updateRadar(); updateProductLabel(); }
    });
    map.on("overlayremove", function(e){
      if (e.name === "Composite Radar (Observed)") {
        obsRadarEnabled = false;
        if (obsRadarOverlay) map.removeLayer(obsRadarOverlay);
        updateProductLabel();
      }
    });

    function applyRadarOpacity(){
      var rs = document.getElementById("radarOpacity");
      if (!rs) return 0.70;
      var v = parseInt(rs.value || "70", 10);
      return Math.max(0.2, Math.min(1, v/100));
    }

    function updateProductLabel(){
      var pl = document.getElementById("productLabel");
      if (!pl) return;
      pl.textContent = obsRadarEnabled ? "RADAR" : "MAP";
    }

    function updateRadar(){
      if (!obsRadarEnabled) return;

      var url = radarUrlFor(curZ);
      var img = new Image();
      img.onload = function(){
        if (obsRadarOverlay) map.removeLayer(obsRadarOverlay);
        obsRadarOverlay = L.imageOverlay(url, RADAR_BOUNDS, { opacity: applyRadarOpacity(), interactive:false });
        obsRadarOverlay.addTo(map);
      };
      img.onerror = function(){ /* missing frame is OK */ };
      img.src = url;
    }

    function updateAlerts(){
      var url = alertsUrlFor(curZ);
      fetch(url).then(function(r){
        if (!r.ok) throw new Error("HTTP " + r.status);
        return r.json();
      }).then(function(gj){
        alertsLayer.clearLayers();
        alertsLayer.addData(gj);
      }).catch(function(){
        alertsLayer.clearLayers();
      });
    }

    function setTimeLabel(){
      document.getElementById("bannerTimeLabel").textContent = formatCentralLabelFromUTC(curZ);
    }

    function updateAll(){
      setTimeLabel();
      updateRadar();
      updateAlerts();
    }

    function clampTime(){
      if (curZ < startZ) curZ = new Date(startZ.getTime());
      if (curZ > endZ)   curZ = new Date(endZ.getTime());
    }

    // ==========================================================
    // Controls
    // ==========================================================
    document.getElementById('bBackBtn').onclick = function(){
      curZ = new Date(curZ.getTime() - STEP_HOURS*3600*1000);
      clampTime(); updateAll();
    };
    document.getElementById('bFwdBtn').onclick = function(){
      curZ = new Date(curZ.getTime() + STEP_HOURS*3600*1000);
      clampTime(); updateAll();
    };

    document.getElementById("zoomInBtn").onclick = function(){ map.zoomIn(); };
    document.getElementById("zoomOutBtn").onclick = function(){ map.zoomOut(); };

    document.getElementById("radarOpacity").oninput = function(){
      if (obsRadarOverlay && obsRadarEnabled) obsRadarOverlay.setOpacity(applyRadarOpacity());
    };

    // Student/Teacher mode
    function setMode(mode){
      var modeBtn = document.getElementById("modeBtn");
      if (mode === "teacher"){
        document.body.classList.remove("student-mode");
        modeBtn.textContent = "TEACHER";
      } else {
        document.body.classList.add("student-mode");
        modeBtn.textContent = "STUDENT";
      }
    }
    document.getElementById("modeBtn").onclick = function(){
      var isStudent = document.body.classList.contains("student-mode");
      setMode(isStudent ? "teacher" : "student");
    };
    setMode("student");

    // ==========================================================
    // Story (Google Sheet)
    // ==========================================================
    var storyStarted = false;
    var storyItems = [];
    var storyMarkers = [];
    var storyIndex = 0;
    var focusRing = null;

    var storyPanel = document.getElementById("storyPanel");
    var storyTitleEl = document.getElementById("storyTitle");
    var storyBodyEl  = document.getElementById("storyBody");
    var storyStepEl  = document.getElementById("storyStep");

    function storyOpen(){
      storyPanel.classList.add("story-open");
      setTimeout(function(){ map.invalidateSize(); }, 220);
    }
    function storyClose(){
      storyPanel.classList.remove("story-open");
      setTimeout(function(){ map.invalidateSize(); }, 220);
    }

    function renderStory(i, panTo){
      if (!storyItems.length) return;
      if (i < 0) i = 0;
      if (i >= storyItems.length) i = storyItems.length - 1;
      storyIndex = i;

      var item = storyItems[storyIndex];
      storyTitleEl.textContent = item.title || "Storm Story";

      var html = "";
      if (item.text) {
        String(item.text).split(/\n+/).filter(Boolean).forEach(function(p){
          html += "<p>" + escapeHtml(p) + "</p>";
        });
      } else {
        html += "<p class='tiny'>No text for this station yet.</p>";
      }

      if (item.image){
        html += "<div class='story-media'><img src='" + item.image + "' alt='Story image'></div>";
      }
      if (item.video){
        html += "<div class='story-media'><iframe src='" + item.video + "' allow='accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture' allowfullscreen></iframe></div>";
      }

      storyBodyEl.innerHTML = html;
      storyStepEl.textContent = "Station " + (storyIndex + 1) + " of " + storyItems.length;

      storyMarkers.forEach(function(m, idx){
        if (!m || !m.setStyle) return;
        m.setStyle({
          radius: (idx===storyIndex? 12 : 8),
          opacity: 1,
          fillOpacity: (idx===storyIndex? 1 : 0.9),
          weight: (idx===storyIndex? 3 : 2)
        });
        if (idx===storyIndex && m.bringToFront) m.bringToFront();
      });

      if (item.lat != null && item.lon != null) {
        var ringRadiusM = 22000;
        if (!focusRing){
          focusRing = L.circle([item.lat, item.lon], {
            radius: ringRadiusM,
            color: "rgba(30,136,229,0.95)",
            weight: 2,
            opacity: 0.95,
            fill: false,
            dashArray: "6 6"
          }).addTo(map);
        } else {
          focusRing.setLatLng([item.lat, item.lon]);
          focusRing.setRadius(ringRadiusM);
        }
        if (focusRing.bringToFront) focusRing.bringToFront();
      }

      if (storyStarted) storyOpen();
      if (panTo && item.lat != null && item.lon != null) map.panTo([item.lat, item.lon], { animate:true });
    }

    function buildStoryMarkers(){
      storyMarkers.forEach(function(m){ try{ map.removeLayer(m); }catch(e){} });
      storyMarkers = [];

      storyItems.forEach(function(item, idx){
        if (typeof item.lat !== "number" || typeof item.lon !== "number") return;
        var m = L.circleMarker([item.lat, item.lon], {
          radius: 8,
          color: "rgba(255,255,255,0.95)",
          weight: 2,
          fillColor: "rgba(30,136,229,0.95)",
          fillOpacity: 0.9
        }).addTo(map);

        m.on("click", function(){ renderStory(idx, false); });
        if (item.title) m.bindTooltip(item.title, { direction:"top", offset:[0,-8], opacity:0.9 });
        storyMarkers.push(m);
      });

      renderStory(0, false);
    }

    function loadStory(){
      var url = "https://opensheet.elk.sh/" + SHEET_ID + "/" + encodeURIComponent(SHEET_TAB);
      fetch(url).then(function(r){
        if (!r.ok) throw new Error("HTTP " + r.status);
        return r.json();
      }).then(function(rows){
        storyItems = (rows || []).map(function(r){
          var lat = parseFloat(r.lat);
          var lon = parseFloat(r.lon);
          return {
            title: r.title || "",
            text: r.text || "",
            lat: isFinite(lat) ? lat : null,
            lon: isFinite(lon) ? lon : null,
            image: (r.image || "").trim(),
            video: (r.video || "").trim(),
            order: parseFloat(r.order)
          };
        }).filter(function(x){
          return x.title || x.text || (x.lat!=null && x.lon!=null);
        }).sort(function(a,b){
          var ao = isFinite(a.order) ? a.order : 9999;
          var bo = isFinite(b.order) ? b.order : 9999;
          return ao - bo;
        });

        if (!storyItems.length){
          storyBodyEl.innerHTML = "<p class='tiny'>No rows found in your Google Sheet tab.</p>";
          return;
        }
        buildStoryMarkers();
      }).catch(function(){
        storyBodyEl.innerHTML = "<p class='tiny'>Could not load story from Google Sheet (check publish + tab name).</p>";
      });
    }

    document.getElementById("beginStoryBtn").onclick = function(){
      storyStarted = true;
      renderStory(storyIndex, true);
    };
    document.getElementById("storyCloseBtn").onclick = storyClose;
    document.getElementById("storyPrevBtn").onclick = function(){ renderStory(storyIndex - 1, true); };
    document.getElementById("storyNextBtn").onclick = function(){ renderStory(storyIndex + 1, true); };

    loadStory();

    // ==========================================================
    // Init
    // ==========================================================
    updateAll();
  })();
  </script>
</body>
</html>
